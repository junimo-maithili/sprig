/*
First time? Check out the tutorial game:
https://sprig.hackclub.com/gallery/getting_started

@title: The Game
@author: maithili-r
@tags: []
@addedOn: 2025-00-00
*/

const player = "p"
const note = "b"
const wall = "w"
const bg = "a"

let score = 0
let totalNotes = 0

const melody21 = tune`
250: D4~250,
250: E4~250,
250: F4~250,
250: G4~250,
250: A4~250,
250: A4~250,
250: D5~250,
250: C5~250,
250: A4~250,
250: A4~250,
250: D4~250,
250: D4~250,
250: A4~250,
250: G4~250,
250: F4~250,
250: E4~250,
250: D4~250,
250: E4~250,
250: F4~250,
250: G4~250,
250: A4~250,
250: A4~250,
250: G4~250,
250: F4~250,
250: E4~250,
250: D4~250,
250: E4~250,
250: F4~250,
250: E4~250,
250: D4~250,
250: C4~250,
250: E4~250,
250: D4~250,
250: E4~250,
250: F4~250,
250: G4~250,
250: A4~250,
250: A4~250,
250: D5~250,
250: C5~250,
250: A4~250,
250: A4~250,
250: D4~250,
250: D4~250,
250: A4~250,
250: G4~250,
250: F4~250,
250: E4~250,
250: D4~250,
250: E4~250,
250: F4~250,
250: G4~250,
250: A4~250,
250: A4~250,
250: G4~250,
250: F4~250,
250: E4~250,
250: E4~250,
250: F4~250,
250: F4~250,
250: G4~250,
250: G4~250,
250: A4~250,
250: A4~250,
250: D5~250,
250: E5~250,
250: B4~250,
250: A4~250,
250: B4~250,
250: B4~250,
250: A4~250,
250: B4~250,
250: D5~250,
250: E5~250,
250: B4~250,
250: A4~250,
250: B4~250,
250: B4~250,
250: A4~250,
250: B4~250,
250: A4~250,
250: G4~250,
250: F4~250,
250: D4~250,
250: E4~250,
250: E4~250,
250: D4~250,
250: E4~250,
250: F4~250,
250: G4~250,
250: A4~250,
250: B4~250,
250: E4~250,
250: E4~250,
250: B4~250,
250: D5~250,
250: D5~250,
250: E5~250,
250: B4~250,
250: A4~250,
250: B4~250,
250: B4~250,
250: A4~250,
250: B4~250,
250: D5~250,
250: E5~250,
250: B4~250,
250: A4~250,
250: B4~250,
250: B4~250,
250: E5~250,
250: G5~250,
250: B5~250,
250: A5~250,
250: G5~250,
250: F5~250,
250: E5~250,
250: E5~250,
250: D5~250,
250: E5~250,
250: D5~250,
250: C5~250,
250: B4~250,
250: G4~250,
250: A4~250,
250: A4~250,
250: A4~250,
250: A4~250

`


setLegend(
  [ player, bitmap`
................
................
................
...333....333...
..33333..33333..
..333333333333..
..333333333333..
..333333333333..
...3333333333...
...3333333333...
.....333333.....
......3333......
......3333......
.......33.......
................
................` ],
  [ note, bitmap`
................
................
................
.....666666.....
....63333336....
...6333333236...
...6333333236...
...6333333336...
...6333333236...
...6333333336...
...6333333336...
...6333333336...
....63333336....
.....666666.....
................
................`],
  [ wall, bitmap`
........3.......
........3.......
........3.......
........3.......
........3.......
........3.......
........3.......
........3.......
........3.......
........3.......
........3.......
........3.......
........3.......
........3.......
........3.......
........3.......`],
  [ bg, bitmap`
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000`],
)


// Start

setSolids([ player, wall])
setBackground(bg)

let level = 0
const levels = [
  map`
w.w.w.w.w
w.w.w.w.w
w.w.w.w.w
w.w.w.w.w
w.w.w.w.w
.........
....p....`
]

setMap(levels[level])

setPushables({
})


onInput("a", () => {
  getFirst(player).x = 1
})
onInput("d", () => {
  getFirst(player).x = 3
})
onInput("j", () => {
  getFirst(player).x = 5
})
onInput("l", () => {
  getFirst(player).x = 7
})

afterInput(() => {
  
})

let allNotes = getAll(note);
function createNote() {
  totalNotes += 1
  console.log(totalNotes)
  x = Math.floor(Math.random()*4+1)*2-1
  addSprite(x, 0, note)
}

function moveNote() {
  addText("" + score + " ", { 
  x: 18,
  y: 14,
  color: color`3`
})

  allNotes = getAll(note);
  for (j = 0; j < allNotes.length; j++) {
    for (i = 0; i < 1000; i++) {
      allNotes[i].y += 1
      if (allNotes[i].y == 6) {
        if (getFirst(player).x == allNotes[i].x) {
          
          score += 1
          console.log("score increased!")
        }
        allNotes[i].remove()
      }
    }
  }
}

let generateNoteTimer = setInterval(createNote, 250);
let moveNoteTimer = setInterval(moveNote, 250);

let playback = playTune(melody21, Infinity);
